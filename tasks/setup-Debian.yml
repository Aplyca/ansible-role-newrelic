---
- name: Add the New Relic package repo to apt
  sudo: yes
  apt_repository:
    repo: 'deb http://apt.newrelic.com/debian/ newrelic non-free'
    state: present

- name: Add an Apt signing key for New relic repo
  sudo: yes
  apt_key:
    id: 548C16BF
    url: https://download.newrelic.com/548C16BF.gpg
    state: present

- name: Install NewRelic with apt
  sudo: yes
  apt:
    name: newrelic-sysmond
    state: present
    force: yes

- name: Validating if PHP is present
  command: php --version
  register: php_present
  ignore_errors: True

- debug: msg="New Relic for PHP will not be isntallaed because PHP is not present"
  when: php_present|failed

- name: Install New Relic for PHP with apt
  sudo: yes
  apt:
    name: newrelic-php5
    state: present
    force: yes
  when: php_present|success
